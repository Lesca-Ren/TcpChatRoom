# 基础知识

- Reactor反应模型

  第一版的服务器用的只是一个简单的Reactor模型。主线程包含一个I/O多路转接器负责处理请求事件，对I/O的处理交给工作线程。

- TCP建立与关闭连接的过程，及优雅关闭连接

  [TCP建立连接的三次握手和断开连接的四次挥手](https://www.cnblogs.com/LCCRNblog/p/5228648.html)着重说一下关闭连接的问题

  - 直接调用close()函数的不安全关闭连接方式：

    在客户端发送消息后，由于当前的服务器没有读取客户端发送的消息，所以客户端发送的消息就在服务器的接收缓冲区里，而此时，服务器也没有给客户端发送消息的需求，就会关闭连接，但是接收缓冲区中还有数据，关闭连接的时候不是发送FIN给客户端，再等客户端回一个ACK之后再关闭连接，而是直接发一个RST，主动关闭了连接，而此时客户端的消息还没接收完整，也就是在还没有读完客户端发来的数据就关闭连接了。

  - 安全关闭连接的方式：调用shutdown(sockfd, SHUT_WR)函数，关闭TCP的写端

    关闭TCP连接的写端，这样会使客户端的read返回0，这样客户端就会关闭连接，客户端关闭连接后，服务器的read也会返回0，服务器再关闭连接，这样就是完整的通信，就不会出现数据丢失的情况了

    

    